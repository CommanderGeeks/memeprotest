<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - The Meme Protest</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .profile-header {
            background: linear-gradient(135deg, var(--electric-blue) 0%, var(--hot-pink) 100%);
            padding: 3rem 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .profile-header h1 {
            color: var(--black);
            font-size: 4rem;
            margin-bottom: 0.5rem;
        }

        .username-display {
            color: var(--black);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .username-edit {
            margin-top: 1rem;
        }

        .username-edit button {
            background: var(--black);
            color: var(--electric-blue);
            border: 2px solid var(--black);
        }

        .username-edit button:hover {
            background: transparent;
            color: var(--black);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--dark-gray);
            border: 2px solid var(--medium-gray);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--neon-green);
            transform: translateY(-5px);
        }

        .stat-card-number {
            font-family: 'Bebas Neue', Impact, sans-serif;
            font-size: 4rem;
            color: var(--neon-green);
            line-height: 1;
        }

        .stat-card-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid var(--neon-green);
        }

        .section-header h2 {
            color: var(--neon-green);
        }

        .empty-state {
            background: var(--dark-gray);
            border: 2px dashed var(--medium-gray);
            padding: 3rem 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            color: var(--hot-pink);
            margin-bottom: 1rem;
        }

        .protest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .mini-protest-card {
            background: var(--dark-gray);
            border: 2px solid var(--medium-gray);
            padding: 1.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .mini-protest-card:hover {
            border-color: var(--electric-blue);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }

        .mini-protest-card h3 {
            color: var(--electric-blue);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .mini-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .badge {
            background: var(--medium-gray);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            color: var(--neon-green);
        }

        @media (max-width: 768px) {
            .profile-header h1 {
                font-size: 2.5rem;
            }

            .protest-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">⚡ The Meme Protest</a>
            <ul class="nav-links">
                <li><a href="browse.html">Browse</a></li>
                <li><a href="submit.html">Submit</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="roadmap.html">Roadmap</a></li>
            </ul>
        </div>
    </nav>

    <div class="profile-header">
        <h1>MY PROFILE</h1>
        <p class="username-display" id="usernameDisplay">Loading...</p>
        <div class="username-edit">
            <button class="btn btn-secondary" onclick="changeUsername()">Change Username</button>
        </div>
    </div>

    <main class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-number" id="submittedCount">0</div>
                <div class="stat-card-label">Protests Started</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-number" id="upvotedCount">0</div>
                <div class="stat-card-label">Protests Upvoted</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-number" id="supportedCount">0</div>
                <div class="stat-card-label">Protests Joined</div>
            </div>
        </div>

        <div class="section-header">
            <h2>My Protests</h2>
            <a href="submit.html" class="btn btn-primary">+ Start New Protest</a>
        </div>

        <div id="myProtestsSection">
            <!-- Will be populated by JavaScript -->
        </div>

        <div class="section-header" style="margin-top: 4rem;">
            <h2>My Upvotes</h2>
        </div>

        <div id="myUpvotesSection">
            <!-- Will be populated by JavaScript -->
        </div>

        <div class="section-header" style="margin-top: 4rem;">
            <h2>Protests I've Joined</h2>
        </div>

        <div id="mySupportedSection">
            <!-- Will be populated by JavaScript -->
        </div>
    </main>

    <footer>
        <p>&copy; 2026 The Meme Protest. A movement, not an organization. Started by students who believed memes could change the world.</p>
        <p style="margin-top: 0.5rem; color: var(--neon-green);">Armed with memes. Powered by passion. Built for the future.</p>
    </footer>

    <script src="shared.js"></script>
    <script>
        let currentUser = getCurrentUser();

        function changeUsername() {
            const newUsername = prompt('Enter your new username:', currentUser.username || '');
            if (newUsername && newUsername.trim()) {
                setUsername(newUsername.trim());
                currentUser = getCurrentUser();
                loadProfile();
            }
        }

        function loadProfile() {
            // Ensure user has a username
            if (!currentUser.username) {
                const username = prompt('Welcome! Please set your username to continue:');
                if (username && username.trim()) {
                    setUsername(username.trim());
                    currentUser = getCurrentUser();
                } else {
                    document.getElementById('usernameDisplay').textContent = 'Anonymous (Click to set username)';
                    return;
                }
            }

            // Display username
            document.getElementById('usernameDisplay').textContent = `@${currentUser.username}`;

            // Get all protests
            const allProtests = getProtests();

            // Get user's protests
            const myProtests = allProtests.filter(p => 
                currentUser.submittedProtests.includes(p.id)
            );

            const myUpvotedProtests = allProtests.filter(p => 
                currentUser.votedProtests.includes(p.id)
            );

            const mySupportedProtests = allProtests.filter(p => 
                currentUser.supportedProtests.includes(p.id) && !currentUser.submittedProtests.includes(p.id)
            );

            // Update stats
            document.getElementById('submittedCount').textContent = myProtests.length;
            document.getElementById('upvotedCount').textContent = myUpvotedProtests.length;
            document.getElementById('supportedCount').textContent = mySupportedProtests.length;

            // Render sections
            renderProtests(myProtests, 'myProtestsSection', 'You haven\'t started any protests yet. Time to make some noise!', true);
            renderProtests(myUpvotedProtests, 'myUpvotesSection', 'You haven\'t upvoted any protests yet. Browse and support what you believe in!');
            renderProtests(mySupportedProtests, 'mySupportedSection', 'You haven\'t joined any protests yet. Find your cause and join the movement!');
        }

        function renderProtests(protests, containerId, emptyMessage, showDelete = false) {
            const container = document.getElementById(containerId);

            if (protests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Nothing Here Yet</h3>
                        <p>${emptyMessage}</p>
                        <a href="${showDelete ? 'submit.html' : 'browse.html'}" class="btn btn-primary mt-2">
                            ${showDelete ? 'Start a Protest' : 'Browse Protests'}
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="protest-grid">
                    ${protests.map(protest => `
                        <div class="mini-protest-card" onclick="window.location.href='protest.html?id=${protest.id}'">
                            <h3>${protest.title}</h3>
                            <div class="mini-meta">
                                <span class="badge">▲ ${protest.upvotes} upvotes</span>
                                <span>${formatTimestamp(protest.timestamp)}</span>
                            </div>
                            <div style="margin-top: 0.5rem; color: var(--text-secondary);">
                                ${protest.university}
                            </div>
                            ${showDelete ? `
                                <button 
                                    class="btn btn-secondary mt-2" 
                                    style="width: 100%; padding: 0.5rem;"
                                    onclick="event.stopPropagation(); confirmDelete(${protest.id})"
                                >
                                    Delete
                                </button>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function confirmDelete(protestId) {
            if (confirm('Are you sure you want to delete this protest? This cannot be undone.')) {
                deleteProtest(protestId);
                loadProfile();
                alert('Protest deleted.');
            }
        }

        // Load profile on page load
        window.addEventListener('DOMContentLoaded', loadProfile);
    </script>
</body>
</html>
